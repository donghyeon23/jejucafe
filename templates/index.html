<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

    <!-- Bulma CSS 링크 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">

    <!-- font-awesome 링크  -->
    <script src="https://kit.fontawesome.com/23b05056a7.js" crossorigin="anonymous"></script>

    <title>돌하르방의 티타임 | 메인페이지</title>
    <style>
        .nav-left {
            float: left;
        }

        .nav-right {
            float: right;
            font-weight: bold;
            line-height: 80px;
        }


        body, html {
            height: 100%;
        }

        /* The hero image */
        .hero-image {
            background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url("http://localguide.co.kr/wp-content/uploads/2020/07/20200110-g100-0761-1-e1597759075396-2048x732.jpeg");
            height: 50%;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            position: relative;
        }

        .hero-text {
            text-align: center;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
        }

        .main-text {
            font-size: 60px;
            font-weight: bold;
            margin-top: 60px;
        }


        .new-cafebox {
            display: none;
            width: 500px;
            margin: auto;
            border-style: solid;
            border-radius: 10px;
            padding: 30px 50px 50px 30px;
            margin-top: 50px;
        }

        .btn_newcafe {
            margin-top: 10px;
        }


        .search-margin {
            margin-top: 60px;
        }


        .cards-wrap {
            width: 1200px;
            margin: 10px auto 0px auto;
        }

        .put-icon img {
            position: relative;
        }

        .put-icon i {
            position: absolute;
            float: right;

            z-index: 1000;
        }

        .card-img-top {
            width: 100%;
            height: 15vw;
            object-fit: cover;

        }

        /*카드 hover시 커서 변경 및 크기 확대*/
        .card {
            margin-top: 10px;
            position: relative;
            z-index: 1;

        }

        .like-button {
            position: absolute;
            color: red;
            right: 0;
            z-index: 2;
        }

        .card:hover {
            opacity: 1;
            transform: scale(1.05);
            cursor: pointer;
        }

    </style>
    <script>
        $(document).ready(function () {
                showComments();
            });

        function post() {
            let score = $('#score-box').val()
            let comment = $('#comment-box').val()
            let cafe_name = $('#card-selected').val()
            console.log(cafe_name)
            $.ajax({
                type: "POST",
                url: "/api/comment",
                data: {
                    cafe_name_give: cafe_name,
                    user_name_give: `{{user_info['username']}}`,
                    nickname_give: `{{user_info['nickname']}}`,
                    score_give: score,
                    comment_give: comment
                },
                success: function (response) {
                    alert(response["msg"])
                    window.location.reload();

                }
            });
        }

        function Add_newcafe() {
            let name = $('#New-name').val()
            let Area = $('#New-Area').val()
            let Address = $('#New-address').val()

            $.ajax({
                type: "POST",
                url: "/api/create",
                data: {
                    CafeName_give: name,
                    CafeArea_give: Area,
                    CafeAddress_give: Address
                },
                success: function (response) {
                    alert(response["msg"])
                    window.location.reload()
                }
            })
        }



        function showComments() {
            $.ajax({
                type: "GET",
                url: "/api/read",
                data: {},
                success: function (response) {
                    $('#saved_comments').empty()
                    let lists = response['all_replies']
                    for (let i = 0; i < lists.length; i++) {
                        let nickname = lists[i]['nickname']
                        let score = lists[i]['score']
                        let comment = lists[i]['comment']

                        let temp_html = `<tr>
                                            <td>${nickname}</td>
                                            <td>${score}</td>
                                            <td>${comment}</td>
                                        </tr>`
                        console.log(temp_html)
                        $('#saved_comments').append(temp_html)
                    }
                }
            })
        }

        function openClose() {
            let status = $('#post-box').css('display');
            if (status == 'block') {
                $('#post-box').hide();
            } else {
                $('#post-box').show();
            }
        }


        function change_url(val) {
            window.location = '/api/posts/?area=' + val
        }

        function like_post(name) {
            $.ajax({
                type: "POST",
                url: "/api/like",
                data: {
                    cafe_name_give: name,
                    user_name_give: `{{user_info['username']}}`
                },
                success: function (response) {
                    alert(response["msg"])
                    window.location.reload();

                }
            });
        }


    </script>
</head>
<body>

<!--네비게이션 바-->
<nav class="navbar is-fixed-top is-white" role="navigation" aria-label="main navigation">
    <div class="navbar-brand nav-left">
        <a class="navbar-item">
            <img src="">
            <strong class="is-sparta"
                    style="font-family: 'Stylish', sans-serif;font-size: larger;">Home</strong>
        </a>
    </div>
    <div class="nav-right"><a href="/api/login">로그아웃</a></div>
</nav>

<!--hero banner-->
<div class="hero-image">
    <div class="hero-text">
        <h1 class="main-text">돌하르방의 티타임</h1><br>
        <p>신규 카페를 추가해보세요</p><br>
        <button type="button" class="btn btn-outline-primary" onclick="openClose()">카페 추가하기</button>
    </div>

</div>


<!--신규카페 포스팅 박스-->
<form class="new-cafebox" id="post-box">
    <div class="form-group">
        <label>카페명</label>
        <input type="text" class="form-control" id="New-name" aria-describedby="emailHelp" placeholder="">
    </div>
    <div>
        <label class="my-1 mr-2" for="inlineFormCustomSelectPref">지역</label>
        <select class="custom-select my-1 mr-sm-2" id="New-Area">
            <option selected value="">지역선택</option>
            <option value="제주시">제주시</option>
            <option value="성산읍">제주동부</option>
            <option value="서귀포시">서귀포</option>
            <option value="애월읍">제주서부</option>
        </select>
    </div>
    <br>
    <div class="form-group">
        <label for="exampleInputEmail1">세부주소</label>
        <input type="text" class="form-control" id="New-address" aria-describedby="emailHelp"
               placeholder="ex) 제주시 공항로 2">
    </div>
    <button type="button" class="btn_newcafe" onclick="Add_newcafe()">추가</button>
</form>

<!--카드내용-->
<div class="cards-wrap">

    <!--하단 바-->
    <nav class="level search-margin">
        <!-- Left side (빈공간) -->
        <div class="level-left">
            <button onclick="window.location.href='/api/mycafe'">내가 찜한 카페 보기</button>
        </div>

        <!-- Right side -->
        <div class="level-right">
            <div class="level-item">
                <div style="display: inline-block">
                    <select name="area" onchange="change_url(this.value);">
                        <option value="" selected="selected">-지역선택-</option>
                        <option value="지역전체">지역전체</option>
                        <option value="제주시">제주시</option>
                        <option value="성산읍">제주동부</option>
                        <option value="서귀포시">서귀포</option>
                        <option value="애월읍">제주서부</option>
                    </select>
                </div>
            </div>
            <div class="level-item">
                <div class="field has-addons">
                    <p class="control">
                        <input class="input" type="text" placeholder="Find a cafe">
                    </p>
                    <p class="control">
                        <button class="button">
                            Search
                        </button>
                    </p>
                </div>
            </div>
        </div>

    </nav>


    <!--카드-->
    <!--빈하트 <i class="fa fa-heart-o" aria-hidden="true"></i>-->
    <!--색칠된하트<i class="fa fa-heart" aria-hidden="true"></i>-->

    <div class="card-columns">

        {# jinja2 카드 내용 불러오기 #}
        {% for cafe in cafe_lists %}

        <!--        <div class="card" onclick='$("#modal-post").addClass("is-active")'>-->
        <div class="card" id="selected-card">
            <div href="#" class="like-button" onclick="like_post('{{cafe.cafe_name}}')">
                {% if cafe.cafe_name in user_info.like%}
                <i class="fas fa-heart"></i>
                {% else %}
                <i class="far fa-heart"></i>
                {% endif %}
            </div>
            <div onclick='$("#modal-post").addClass("is-active")'>
                <img class="card-img-top" src="{{ cafe.cafe_thumbnail_url }}"
                     alt="Card image cap">
                <div class="card-body">
                    <h5 class="card-title" id="card-selected"><b>{{ cafe.cafe_name }}</b></h5>
                    <p class="card-text">{{ cafe.cafe_address }}</p>
                </div>
            </div>
        </div>
        {% endfor %}


    </div>

</div>

<!--카드 클릭 시 팝업되는 모달-->
<!--클릭한 카드에 대한 개별화된 모달로 업데이트 필요-->


<div class="modal" id="modal-post">
    <div class="modal-background" onclick='$("#modal-post").removeClass("is-active")'></div>
    <div class="modal-content">
        <div class="box">
            <article class="media">
                <div class="media-content">
                    <div class="field">
                        <p class="control">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th scope="col">닉네임</th>
                                <th scope="col">점수</th>
                                <th scope="col">코멘트</th>
                            </tr>
                            </thead>
                            <tbody id="saved_comments">
                            <tr>
                                <td>Mark</td>
                                <td>5</td>
                                <td>맛있어요!</td>
                            </tr>
                            <tr>
                                <td>Hodoo</td>
                                <td>3</td>
                                <td>맛있는데 직원분이 불친절해서 2점 뺐어요</td>
                            </tr>
                            </tbody>
                        </table>
                        <div class="btn-group">
                            <select class="custom-select my-1 mr-sm-2" id="score-box">
                                <option selected>SCORE</option>
                                <option value="5">5</option>
                                <option value="4">4</option>
                                <option value="3">3</option>
                                <option value="2">2</option>
                                <option value="1">1</option>
                            </select>
                        </div>

                        <textarea id="comment-box" class="textarea" placeholder="코멘트를 작성하세요"></textarea>
                        </p>
                    </div>
                    <nav class="level is-mobile">
                        <div class="level-left">

                        </div>
                        <div class="level-right">
                            <div class="level-item">
                                <a class="button is-sparta" onclick="post()">포스팅하기</a>
                            </div>
                            <div class="level-item">
                                <a class="button is-sparta is-outlined"
                                   onclick='$("#modal-post").removeClass("is-active")'>취소</a>
                            </div>
                        </div>
                    </nav>
                </div>
            </article>
        </div>
    </div>
    <button class="modal-close is-large" aria-label="close"
            onclick='$("#modal-post").removeClass("is-active")'></button>
</div>


</body>

</html>